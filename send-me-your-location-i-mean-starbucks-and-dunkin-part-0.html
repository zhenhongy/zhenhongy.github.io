<!DOCTYPE html>
<!--[if lt IE 7]>      <html lang="en" class="no-js lt-ie9 lt-ie8 lt-ie7" prefix="og: http://ogp.me/ns#" itemscope itemtype="http://schema.org/BlogPosting"> <![endif]-->
<!--[if IE 7]>         <html lang="en" class="no-js lt-ie9 lt-ie8" prefix="og: http://ogp.me/ns#" itemscope itemtype="http://schema.org/BlogPosting"> <![endif]-->
<!--[if IE 8]>         <html lang="en" class="no-js lt-ie9" prefix="og: http://ogp.me/ns#" itemscope itemtype="http://schema.org/BlogPosting"> <![endif]-->
<!--[if gt IE 8]><!--> <html lang="en" class="no-js" prefix="og: http://ogp.me/ns#" itemscope itemtype="http://schema.org/BlogPosting"> <!--<![endif]-->
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Send me your location, I mean Starbucks and Dunkin' - Part 0</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="First step! Scrape geometric data of Starbucks' and Dunkin's store. Most importantly and time-consumingly, get the number of each type of merchant nearby using Google Place API.">
<link rel="shortcut icon" href="http://zhenhongy.github.io/images/favicon.ico" type="image/vnd.microsoft.icon">
<meta name="author" content="Don(Zhenhong) Yang">
<meta name="copyright" content="Don(Zhenhong) Yang">
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@" />
<meta property="og:site_name" content="Don & Zhenhong's Data Lab" />

<meta property="og:title" content="Send me your location, i mean starbucks and dunkin' - part 0" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://zhenhongy.github.io/send-me-your-location-i-mean-starbucks-and-dunkin-part-0.html" />
<meta property="fb:app_id" content="317889598672371" />
<meta name="twitter:title" content="Send me your location, i mean starbucks and dunkin' - part 0" />
<meta name="twitter:url" content="http://zhenhongy.github.io/send-me-your-location-i-mean-starbucks-and-dunkin-part-0.html" />
<meta itemprop="url" content="http://zhenhongy.github.io/send-me-your-location-i-mean-starbucks-and-dunkin-part-0.html" />
<meta property="og:description" content="First step! Scrape geometric data of Starbucks&#39; and Dunkin&#39;s store. Most importantly and time-consumingly, get the number of each type of merchant nearby using Google Place API." />
<meta name="twitter:description" content="First step! Scrape geometric data of Starbucks&#39; and Dunkin&#39;s store. Most importantly and time-consumingly, get the number of each type of merchant nearby using Google Place API." />
<meta property="og:article:published_time" content="2017-09-23" />
<meta property="og:article:author" content="Don(Zhenhong) Yang" >
<meta property="og:article:tag" content="Data Collection">
<meta property="og:article:tag" content="Data Manipulation">
<meta property="og:image" content="https://zhenhongy.github.io/images/starbucks_dd/page.jpg" />
<meta property="og:image:secure_url" content="https://zhenhongy.github.io/images/starbucks_dd/page.jpg" />
<meta name="twitter:image" content="https://zhenhongy.github.io/images/starbucks_dd/page.jpg" />
<meta itemprop="image" content="https://zhenhongy.github.io/images/starbucks_dd/page.jpg"/>

<link href="http://zhenhongy.github.io/None" type="application/atom+xml" rel="alternate" title="Don & Zhenhong's Data Lab ATOM Feed"/>
<link href='//fonts.googleapis.com/css?family=Open+Sans:800italic' rel='stylesheet' type='text/css'>
<link href='//fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/uikit/2.15.0/css/uikit.min.css">
<link rel="stylesheet" href="/theme/css/solarized.css">
<link rel="stylesheet" href="/theme/css/main.css">

<script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"></script>
</head>
<body>
<!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

<header class=" mg-header uk-navbar uk-navbar-attached">

    <div class="uk-container uk-container-center">
        <div class="uk-grid" data-uk-grid-margin>

            <a class="mg-brand uk-navbar-brand uk-hidden-small" href="http://zhenhongy.github.io">Don & Zhenhong's Data Lab</a>
            <div class="mg-tagline uk-navbar-content uk-hidden-small">Let me tell you a story...</div>
            <a class="uk-navbar-toggle uk-visible-small" href="#mg-offcanvas" data-uk-offcanvas></a>
            <a class="mg-brand uk-navbar-brand uk-navbar-center uk-visible-small" href="http://zhenhongy.github.io">Don & Zhenhong's Data Lab</a>

        </div>
    </div>
</header>

<main class="mg-main">

<div class="uk-container uk-container-center">

    <div class="uk-grid" data-uk-grid-margin>
        
<div class="mg-container-social uk-width-medium-1-10 uk-hidden-small">

    <div class="uk-panel" id="mg-panel-social">
        <ul class="uk-nav uk-nav-side">
            <li>
            <a href="https://www.facebook.com/sharer/sharer.php?u=http://zhenhongy.github.io/send-me-your-location-i-mean-starbucks-and-dunkin-part-0.html" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;" taget="_blank" class="uk-button"><i class="uk-icon-facebook-square"></i> </a>
            </li>
            <li>
            <a href="https://twitter.com/intent/tweet?text=Send%20me%20your%20location%2C%20I%20mean%20Starbucks%20and%20Dunkin%27%20-%20Part%200&url=http://zhenhongy.github.io/send-me-your-location-i-mean-starbucks-and-dunkin-part-0.html&via=" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" class="uk-button" target="_blank"><i class="uk-icon-twitter"></i> </a>
            </li>
            <li>
            <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://zhenhongy.github.io/send-me-your-location-i-mean-starbucks-and-dunkin-part-0.html" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;" taget="_blank" class="uk-button"><i class="uk-icon-linkedin"></i> </a>
            </li>
            <li>
            <a href="https://plus.google.com/share?url=http://zhenhongy.github.io/send-me-your-location-i-mean-starbucks-and-dunkin-part-0.html" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank" class="uk-button"><i class="uk-icon-google-plus-square"></i> </a>
            </li>
        </ul>
    </div>

</div>

<div class="uk-width-medium-7-10">

    <article class="uk-article">
        <h1 class="uk-heading-large uk-article-title" itemprop="name">Send me your location, I mean Starbucks and Dunkin' - Part 0</h1>
        <p class="uk-article-meta"><time datetime="2017-09-23" itemprop="datePublished">Sat 23 September 2017</time> in <a href="http://zhenhongy.github.io/category/business.html">Business</a>, <br class="uk-visible-small"><i class="uk-icon-comment"></i> <a href="http://zhenhongy.github.io/send-me-your-location-i-mean-starbucks-and-dunkin-part-0.html#disqus_thread" itemprop="discussionUrl"></a></p>

        <a href="https://www.facebook.com/sharer/sharer.php?u=http://zhenhongy.github.io/send-me-your-location-i-mean-starbucks-and-dunkin-part-0.html" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;" taget="_blank" class="uk-button uk-visible-small"><i class="uk-icon-facebook-square"></i> </a>
        <a href="https://twitter.com/intent/tweet?text=Send%20me%20your%20location%2C%20I%20mean%20Starbucks%20and%20Dunkin%27%20-%20Part%200&url=http://zhenhongy.github.io/send-me-your-location-i-mean-starbucks-and-dunkin-part-0.html&via=" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" class="uk-button uk-visible-small" target="_blank"><i class="uk-icon-twitter"></i> </a>
        <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://zhenhongy.github.io/send-me-your-location-i-mean-starbucks-and-dunkin-part-0.html" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;" taget="_blank" class="uk-button uk-visible-small"><i class="uk-icon-linkedin"></i> </a>
        <a href="https://plus.google.com/share?url=http://zhenhongy.github.io/send-me-your-location-i-mean-starbucks-and-dunkin-part-0.html" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank" class="uk-button uk-visible-small"><i class="uk-icon-google-plus-square"></i> </a>

        <section itemprop="articleBody"><p><center>
<img alt="Starbucks&amp;Dunkin'" src="/images/starbucks_dd/page.jpg">
</center>
<a href="https://www.bostonglobe.com/metro/regionals/north/2013/06/01/dunkin-donuts-and-starbucks-battle-out-for-coffee-supremacy-greater-boston/QK33ZCIAGcTNO04aVH6vJN/story.html">Credit: Boston Globe</a></p>
<blockquote>
<p><em>"How many coffee shops in Boston?"</em></p>
</blockquote>
<p>Hmmm...well, suppose there are 1 million people in Boston. Then... NOPE. Stop it. This series is nothing about strategy for any brain teaser.
This is an analysis about two major coffeehouse chains, Starbucks vs Dunkin' Donuts, "corporate + license" vs pure franchise, in Boston area. I will walk you through their distribution and strategies of choosing a location (if consistent). This series is roughly separated by following parts.</p>
<ul>
<li><a href="https://zhenhongy.github.io/send-me-your-location-i-mean-starbucks-and-dunkin-part-0.html">Part 0: Get the data prepared!</a></li>
<li><a href="https://zhenhongy.github.io/send-me-your-location-i-mean-starbucks-and-dunkin-part-1.html">Part 1: A glance at locations</a></li>
<li><a href="https://zhenhongy.github.io/send-me-your-location-i-mean-starbucks-and-dunkin-part-2.html">Part 2: Who are Dunkin's and Starbucks' favorite neighbors? - Emperical Bayes Analysis</a></li>
<li><a href="https://zhenhongy.github.io/send-me-your-location-i-mean-starbucks-and-dunkin-part-3.html">Part 3: What can we expect around a coffeeshop? - Network Visualization</a></li>
</ul>
<hr>
<h1>Get the data prepared!</h1>
<p>In this post, I will show you how I collected data sets for this series. You can also find my code <a href="https://github.com/zhenhongy/starbucks_dd/blob/master/Send%20me%20your%20location%2C%20I%20mean%20Starbucks%20and%20Dunkin'%20-%20Part%200.ipynb">here</a>. Enjoy!</p>
<p>Three kinds of data sets will be needed for this series. However, you can also find the data from the <a href="https://github.com/zhenhongy/starbucks_dd/tree/master/data">folder</a> and skip this post :)</p>
<ul>
<li><strong>Zip code</strong> and <strong>name</strong> of each region in Boston and its neighborhood</li>
<li><strong>Latitude</strong> and <strong>longitude</strong> of all Starbucks' and Dunkin's store</li>
<li><strong>Latitude</strong> and <strong>longitude</strong> of all merchants near each store</li>
</ul>
<p>Take a breath. Here we go!</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span> <span class="k">as</span> <span class="n">Soup</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">settings</span>
</pre></div>


<h2>Zip code</h2>
<p>Let's start from the easiest part! Click <a href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=6&amp;cad=rja&amp;uact=8&amp;ved=0ahUKEwjem9KM1rrWAhUHTSYKHcl7C8sQFgjXATAF&amp;url=http%3A%2F%2Fwww.mass.gov%2Feohhs%2Fdocs%2Fdcf%2Fboston-office-by-zipcode.xls&amp;usg=AFQjCNHnNW6W-SOIr1AL6H5w4Q_hKsVW7Q">here</a> to download the spreadsheet from Mass.gov.</p>
<p>I rename following regions to make them more specific.</p>
<p><center></p>
<table>
<thead>
<tr>
<th align="center">Zip Code</th>
<th align="center">Original Name</th>
<th align="center">New Name</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">02446</td>
<td align="center">Brookline</td>
<td align="center">Brookline North</td>
</tr>
<tr>
<td align="center">02467</td>
<td align="center">Brookline</td>
<td align="center">Brookline Chestnut Hill</td>
</tr>
<tr>
<td align="center">02210</td>
<td align="center">Boston</td>
<td align="center">Boston Seaport</td>
</tr>
</tbody>
</table>
<p></center></p>
<h2>Location of Starbucks and Dunkin'</h2>
<p>Use the zip code we get from the above to scrape all geometric data from their official websites. (<a href="https://www.starbucks.com/store-locator">Starbucks</a> and <a href="https://www.dunkindonuts.com/en/locations">Dunkin'</a>)</p>
<div class="highlight"><pre><span></span><span class="n">zip_code</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="s1">&#39;./data/zip_boston_neighborhood.txt&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;zip_code&#39;</span><span class="p">,</span><span class="s1">&#39;region&#39;</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#To get longitude and latitude from web content</span>
<span class="k">def</span> <span class="nf">store_dict</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">,</span> <span class="n">zip_code</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">output</span>
    <span class="k">for</span> <span class="n">store</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">store</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[</span><span class="n">store</span><span class="p">[</span><span class="nb">id</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;zip_code&#39;</span><span class="p">:</span> <span class="n">zip_code</span><span class="p">,</span> <span class="s1">&#39;geo&#39;</span><span class="p">:</span> <span class="n">store</span><span class="p">[</span><span class="n">coordinates</span><span class="p">]}</span>
    <span class="k">return</span> <span class="n">out</span>  
</pre></div>


<h3>Starbucks</h3>
<div class="highlight"><pre><span></span><span class="n">sb_store</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">zip_code</span><span class="o">.</span><span class="n">zip_code</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://www.starbucks.com/store-locator?place={}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">Soup</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>
    <span class="n">store</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span><span class="nb">id</span> <span class="o">=</span> <span class="s1">&#39;bootstrapData&#39;</span><span class="p">)</span>
    <span class="n">store</span> <span class="o">=</span> <span class="n">store</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">store</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
    <span class="n">sb_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
    <span class="n">sb_dict</span> <span class="o">=</span> <span class="n">sb_dict</span><span class="p">[</span><span class="s1">&#39;storeLocator&#39;</span><span class="p">][</span><span class="s1">&#39;locationState&#39;</span><span class="p">][</span><span class="s1">&#39;locations&#39;</span><span class="p">]</span>
    <span class="n">sb_store</span> <span class="o">=</span> <span class="n">store_dict</span><span class="p">(</span><span class="n">sb_dict</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;coordinates&#39;</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">sb_store</span><span class="p">)</span> 
</pre></div>


<h3>Dunkin'</h3>
<div class="highlight"><pre><span></span><span class="n">dd_store</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">dd_dict</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">zip_code</span><span class="o">.</span><span class="n">zip_code</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://www.mapquestapi.com/search/v2/radius?callback=json111206657990027752725_1504756855257&amp;key=Gmjtd%7Clu6t2luan5%252C72%253Do5-larsq&amp;origin={}&amp;units=m&amp;maxMatches=30&amp;radius=25&amp;hostedData=mqap.33454_DunkinDonuts&amp;ambiguities=ignore&amp;_=1504756855258&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">Soup</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">content</span><span class="p">,</span><span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>
    <span class="n">store</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
    <span class="n">store</span> <span class="o">=</span> <span class="n">store</span><span class="p">[</span><span class="n">store</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">store</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)]</span>
    <span class="n">dd_dict_temp</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
    <span class="n">dd_dict_temp</span> <span class="o">=</span> <span class="n">dd_dict_temp</span><span class="p">[</span><span class="s1">&#39;searchResults&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">dd_dict_temp</span><span class="p">:</span>
        <span class="n">dd_dict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;fields&#39;</span><span class="p">])</span>
    <span class="n">dd_store</span> <span class="o">=</span> <span class="n">store_dict</span><span class="p">(</span><span class="n">dd_dict</span><span class="p">,</span> <span class="s1">&#39;recordid&#39;</span><span class="p">,</span> <span class="s1">&#39;mqap_geography&#39;</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">dd_store</span><span class="p">)</span> 
</pre></div>


<h3>Integration</h3>
<div class="highlight"><pre><span></span><span class="n">sb_nearby</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="n">sb_store</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;geo&#39;</span><span class="p">][</span><span class="s1">&#39;latitude&#39;</span><span class="p">],</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="n">sb_store</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;geo&#39;</span><span class="p">][</span><span class="s1">&#39;longitude&#39;</span><span class="p">]},</span> <span class="s1">&#39;zip_code&#39;</span><span class="p">:</span> <span class="n">sb_store</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;zip_code&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">sb_store</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
<span class="n">dd_nearby</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="n">dd_store</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;geo&#39;</span><span class="p">][</span><span class="s1">&#39;latLng&#39;</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span><span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="n">dd_store</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;geo&#39;</span><span class="p">][</span><span class="s1">&#39;latLng&#39;</span><span class="p">][</span><span class="s1">&#39;lng&#39;</span><span class="p">]},</span> <span class="s1">&#39;zip_code&#39;</span><span class="p">:</span> <span class="n">sb_store</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;zip_code&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dd_store</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
<span class="n">sb_nearby</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;starbucks&#39;</span>
<span class="n">dd_nearby</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dunkin&#39;</span>
<span class="n">sb_nearby</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sb_nearby</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
<span class="n">dd_nearby</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dd_nearby</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
<span class="n">nearby</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">sb_nearby</span><span class="p">,</span> <span class="n">dd_nearby</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">nearby</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">nearby</span><span class="p">,</span> <span class="n">zip_code</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;zip_code&#39;</span><span class="p">)</span>
</pre></div>


<h2>Merchants Nearby</h2>
<p>Finally, this is the last data set we need. Before doing it, you need to get a key for <a href="https://developers.google.com/places/web-service/intro">Google Place API</a>. Google Places API Radar Search Service could be used to find up to 200 nearby merchants by <strong>types</strong> for each search. Thus, we are able to get the number of each type of merchants for a given store. A list of valid <strong>types</strong> could be found <a href="https://developers.google.com/places/web-service/supported_types">here</a>. Additional parameters, like <strong>minprice</strong> and <strong>maxprice</strong>, are usefule if you are interested in diving deeper.</p>
<div class="highlight"><pre><span></span><span class="c1">#search nearby merchants using Google Place API</span>
<span class="k">def</span> <span class="nf">search_nearby</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="n">type_list</span><span class="p">,</span> <span class="n">API_KEY</span><span class="p">,</span> <span class="n">optional_para</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

    <span class="c1">#the key of the dictionay is used as the suffix for output, the value is used as a part of URL</span>
    <span class="n">optional</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;&#39;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">optional_para</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">optional_para</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">optional</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&amp;{}={}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">optional_para</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

    <span class="n">near</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">optional</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">for</span> <span class="nb">type</span> <span class="ow">in</span> <span class="n">type_list</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Working on {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">))</span>
            <span class="n">new_column</span> <span class="o">=</span> <span class="p">[]</span>        
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">datasets</span><span class="o">.</span><span class="n">values</span><span class="p">)):</span>
                <span class="n">row</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://maps.googleapis.com/maps/api/place/radarsearch/json?location={},{}&amp;radius=1000&amp;type={}{}&amp;key={}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nb">type</span><span class="p">,</span> <span class="n">optional</span><span class="p">[</span><span class="n">suffix</span><span class="p">],</span> <span class="n">API_KEY</span><span class="p">)</span>
                <span class="n">page</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                <span class="n">soup</span> <span class="o">=</span> <span class="n">Soup</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">content</span><span class="p">,</span><span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>
                <span class="n">place</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
                <span class="n">place</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">place</span><span class="p">)</span>
                <span class="n">place</span> <span class="o">=</span> <span class="n">place</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">merchant</span> <span class="ow">in</span> <span class="n">place</span><span class="p">:</span>
                    <span class="n">near</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([</span><span class="n">merchant</span><span class="p">[</span><span class="s1">&#39;place_id&#39;</span><span class="p">]]:</span> <span class="n">merchant</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="s1">&#39;location&#39;</span><span class="p">])</span>
                <span class="n">new_column</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">place</span><span class="p">))</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{}</span><span class="si">% i</span><span class="s2">s completed.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">datasets</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
                <span class="n">variable_name</span> <span class="o">=</span> <span class="s2">&quot;{}_{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span>
                <span class="n">datasets</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">new_column</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> 

    <span class="k">return</span> <span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="n">near</span><span class="p">)</span>
</pre></div>


<p>Price level of restaurants and clothing stores is available in Google Place API for search. Thus, I decided to see if Starbucks or Dunkin' has special preference.</p>
<div class="highlight"><pre><span></span><span class="c1">#Define cheap and expensive as price level from 0-2 and 3-4 respectively</span>
<span class="n">optional_keywords_price_level</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cheap&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;minprice&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;maxprice&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">},</span> <span class="s1">&#39;expensive&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;minprice&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;maxprice&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">}}</span>
<span class="c1">#Search nearby cheap and expensive restaurant and clothing store </span>
<span class="n">type_list_with_price</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;restaurant&#39;</span><span class="p">,</span><span class="s1">&#39;clothing_store&#39;</span><span class="p">]</span>
<span class="n">nearby</span><span class="p">,</span> <span class="n">merchants</span> <span class="o">=</span> <span class="n">search_nearby</span><span class="p">(</span><span class="n">nearby</span><span class="p">,</span> <span class="n">type_list_with_price</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">API_KEY</span><span class="p">,</span> <span class="n">optional_keywords_price_level</span><span class="p">)</span>
</pre></div>


<p>Search other types of merchants</p>
<div class="highlight"><pre><span></span><span class="c1">#Search other nearby merchants</span>
<span class="n">type_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;atm&#39;</span><span class="p">,</span> <span class="s1">&#39;bakery&#39;</span><span class="p">,</span> <span class="s1">&#39;bank&#39;</span><span class="p">,</span> <span class="s1">&#39;beauty_salon&#39;</span><span class="p">,</span> <span class="s1">&#39;book_store&#39;</span><span class="p">,</span><span class="s1">&#39;cafe&#39;</span><span class="p">,</span><span class="s1">&#39;car_repair&#39;</span><span class="p">,</span> <span class="s1">&#39;movie_theater&#39;</span><span class="p">,</span> <span class="s1">&#39;convenience_store&#39;</span><span class="p">,</span> <span class="s1">&#39;dentist&#39;</span><span class="p">,</span> <span class="s1">&#39;florist&#39;</span><span class="p">,</span> <span class="s1">&#39;gas_station&#39;</span><span class="p">,</span> <span class="s1">&#39;gym&#39;</span><span class="p">,</span> <span class="s1">&#39;home_goods_store&#39;</span><span class="p">,</span>\
             <span class="s1">&#39;hospital&#39;</span><span class="p">,</span> <span class="s1">&#39;laundry&#39;</span><span class="p">,</span> <span class="s1">&#39;liquor_store&#39;</span><span class="p">,</span> <span class="s1">&#39;museum&#39;</span><span class="p">,</span> <span class="s1">&#39;park&#39;</span><span class="p">,</span> <span class="s1">&#39;pharmacy&#39;</span><span class="p">,</span> <span class="s1">&#39;police&#39;</span><span class="p">,</span> <span class="s1">&#39;real_estate_agency&#39;</span><span class="p">,</span> <span class="s1">&#39;school&#39;</span><span class="p">,</span> <span class="s1">&#39;shopping_mall&#39;</span><span class="p">,</span> <span class="s1">&#39;stadium&#39;</span><span class="p">,</span> <span class="s1">&#39;transit_station&#39;</span><span class="p">,</span> <span class="s1">&#39;university&#39;</span><span class="p">,</span>\
             <span class="s1">&#39;accounting&#39;</span><span class="p">,</span> <span class="s1">&#39;art_gallery&#39;</span><span class="p">,</span> <span class="s1">&#39;bicycle_store&#39;</span><span class="p">,</span> <span class="s1">&#39;car_dealer&#39;</span><span class="p">,</span> <span class="s1">&#39;car_rental&#39;</span><span class="p">,</span> <span class="s1">&#39;car_repair&#39;</span><span class="p">,</span> <span class="s1">&#39;church&#39;</span><span class="p">,</span> <span class="s1">&#39;city_hall&#39;</span><span class="p">,</span> <span class="s1">&#39;department_store&#39;</span><span class="p">,</span> <span class="s1">&#39;electronics_store&#39;</span><span class="p">,</span> <span class="s1">&#39;embassy&#39;</span><span class="p">,</span> <span class="s1">&#39;funeral_home&#39;</span><span class="p">,</span>\
             <span class="s1">&#39;fire_station&#39;</span><span class="p">,</span> <span class="s1">&#39;hindu_temple&#39;</span><span class="p">,</span> <span class="s1">&#39;veterinary_care&#39;</span><span class="p">,</span> <span class="s1">&#39;synagogue&#39;</span><span class="p">,</span> <span class="s1">&#39;post_office&#39;</span><span class="p">,</span> <span class="s1">&#39;physiotherapist&#39;</span><span class="p">,</span> <span class="s1">&#39;parking&#39;</span><span class="p">,</span> <span class="s1">&#39;mosque&#39;</span><span class="p">,</span> <span class="s1">&#39;local_government_office&#39;</span><span class="p">,</span> <span class="s1">&#39;library&#39;</span><span class="p">]</span>
<span class="n">nearby</span><span class="p">,</span> <span class="n">merchants_1</span> <span class="o">=</span> <span class="n">search_nearby</span><span class="p">(</span><span class="n">nearby</span><span class="p">,</span> <span class="n">type_list</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">API_KEY</span><span class="p">)</span>
<span class="n">merchants</span> <span class="o">=</span> <span class="n">merchants</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">merchants_1</span><span class="p">)</span>
</pre></div>


<h2>Done! Don't forget to save it!</h2>
<div class="highlight"><pre><span></span><span class="n">nearby</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;nearby.pkl&#39;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;merchants.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">merchants</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>
</pre></div>


<h2>Why didn't I use Google API to find all Starbucks' and Dunkin's stores directly?</h2>
<p>Google API does not support searching by zip code. You have to provide a pair of latitude and longitude as the center of region. It might be a little more difficult to search through all regions in Boston. Luckily, we can use zip code in their official searching engine. It makes life much easier!</p>
<hr>
<h1>What's next?</h1>
<p>You will have a brief idea of where are those stores located in Boston. Heatmaps will be used to show the density of coffeehouse distribution. Based on the pattern of store locations, it is possible to find some strategies of their business and marketing. And it is also possible to help them find an ideal location according to their location preference.</p></section>
        <hr class="uk-article-divider">
    </article>

    <div id="disqus_thread"></div>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'Don'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
     var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
     dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
     (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</div>
 
    
        <div class="uk-width-medium-1-5 uk-hidden-small">

            <div class="uk-panel uk-panel-box">
                <ul class="uk-nav uk-nav-side">
                    <li class="uk-nav-header">Categories</li>
                    <li class="uk-active"><a href="http://zhenhongy.github.io/category/business.html">Business</a></li>
                    <li class="uk-nav-header">Pages</li>
                    
                    <li >
                        <a href="http://zhenhongy.github.io/pages/about-me.html">About me</a>
                    </li>
                    

                    <li class="uk-nav-divider"></li>
                    <li ><a href="http://zhenhongy.github.io/archives.html">Archives</a></li>
                </ul>
            </div>

            <div class="uk-panel uk-panel-box">
                <h3 class="uk-panel-title">Receive Updates</h3>
                <a rel="alternate" type="application/atom+xml" href="http://zhenhongy.github.io/feeds/all.rss.xml" class="mg-feed"><i class="uk-icon-rss uk-icon-medium"></i> RSS</a>
            </div>
            
            <div class="uk-panel uk-panel-box">
                <h3 class="uk-panel-title">Contacts</h3>
                <a class="mg-icon-link" href="mailto:zhenhongy_1992@hotmail.com">
                    <i class="uk-icon-envelope uk-icon-medium"></i>
                </a>
                <a class="mg-icon-link" href="https://twitter.com/Zhenhong1992">
                    <i class="uk-icon-twitter uk-icon-medium"></i>
                </a>
                <a class="mg-icon-link" href="https://www.linkedin.com/in/zhenhongyang/">
                    <i class="uk-icon-linkedin uk-icon-medium"></i>
                </a>
                <a class="mg-icon-link" href="https://github.com/zhenhongy">
                    <i class="uk-icon-github uk-icon-medium"></i>
                </a>
            </div>

        </div>

    </div>

</div>

</main>

<footer class="mg-footer">
    <div class="uk-container uk-container-center uk-text-center">

        <div class="mg-icons-small uk-subnav uk-visible-small">
            <li><a rel="alternate" type="application/atom+xml" href="http://zhenhongy.github.io/None" class="uk-icon-button uk-icon-rss"></a></li>
            <li>
                <a href="mailto:zhenhongy_1992@hotmail.com" class="uk-icon-button uk-icon-envelope"></a>
            </li>
            <li>
                <a href="https://twitter.com/Zhenhong1992" class="uk-icon-button uk-icon-twitter"></a>
            </li>
            <li>
                <a href="https://www.linkedin.com/in/zhenhongyang/" class="uk-icon-button uk-icon-linkedin"></a>
            </li>
            <li>
                <a href="https://github.com/zhenhongy" class="uk-icon-button uk-icon-github"></a>
            </li>
        </div>

        <div class="mg-author uk-panel">
            <p></p>

            <p>Powered by <a href="http://blog.getpelican.com">Pelican</a>.<br class="uk-visible-small"> Theme <a href="https://github.com/lucachr/pelican-mg">mg</a> by <a href="https://github.com/lucachr">Luca Chiricozzi</a>.</p>
        </div>
    </div> 
</footer>

<div id="mg-offcanvas" class="uk-offcanvas">
    <div class="uk-offcanvas-bar">

        <ul class="uk-nav uk-nav-offcanvas" data-uk-nav>
            <li class="uk-nav-header">Categories</li>
            <li class="uk-active"><a href="http://zhenhongy.github.io/category/business.html">Business</a></li>
            <li class="uk-nav-header">Pages</li>        
            <li >
                <a href="http://zhenhongy.github.io/pages/about-me.html">About me</a>
            </li>
                    

            <li class="uk-nav-divider"></li>
            <li><a href="http://zhenhongy.github.io/">Archives</a></li>
        </ul>
    </div>
</div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="js/vendor/jquery-1.10.2.min.js"><\/script>')</script>
<script src="//cdnjs.cloudflare.com/ajax/libs/uikit/2.15.0/js/uikit.min.js"></script>
<script src="/theme/js/jquery.sticky-kit.js"></script>
<script src="/theme/js/plugins.js"></script>
<script src="/theme/js/main.js"></script>

<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'Don'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
 var s = document.createElement('script'); s.async = true;
 s.type = 'text/javascript';
 s.src = '//' + disqus_shortname + '.disqus.com/count.js';
 (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
 }());
</script>

<script>
(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
                                                        function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
 e=o.createElement(i);r=o.getElementsByTagName(i)[0];
 e.src='//www.google-analytics.com/analytics.js';
 r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
ga('create','UA-106946855-1');ga('send','pageview');
</script>

</body>
</html>
